<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:citrus="http://www.citrusframework.org/schema/config"
        xmlns:file="http://www.springframework.org/schema/integration/file"
        xmlns:si="http://www.springframework.org/schema/integration"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.citrusframework.org/schema/config http://www.citrusframework.org/schema/config/citrus-config.xsd http://www.springframework.org/schema/integration/file http://www.springframework.org/schema/integration/file/spring-integration-file.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:property-placeholder location="classpath:application.properties"/>

    <citrus:schema-repository id="schemaRepository">
      <citrus:locations>
        <citrus:location path="classpath:xsd/HelloService.xsd"/>
      </citrus:locations>
    </citrus:schema-repository>
    
    <citrus:global-variables>
        <citrus:variable name="simulator.name" value="Citrus File Simulator"/>
    </citrus:global-variables>

    <citrus:namespace-context>
        <citrus:namespace prefix="citrus" uri="http://citrusframework.org"/>
    </citrus:namespace-context>

    <bean id="doneFilter" class="com.consol.citrus.simulator.sample.file.filter.DoneFilter"/>
    <bean id="fileToStringTransformer" class="org.springframework.integration.file.transformer.FileToStringTransformer"/>

    <!--Inbound channel -->
    <file:inbound-channel-adapter  id="fileInboundAdapter"
            channel="fileInboundChannel"
            directory="file:${citrus.simulator.file.input.directory}"
            prevent-duplicates="false"
            filter="doneFilter">
        <si:poller fixed-rate="${citrus.simulator.file.poll.interval}" max-messages-per-poll="1"/>
    </file:inbound-channel-adapter>

    <si:channel id="fileInboundChannel">
        <si:queue capacity="1"/>
        <si:interceptors>
            <bean class="com.consol.citrus.simulator.sample.file.interceptor.FileInterceptor">
            </bean>
        </si:interceptors>
    </si:channel>

<!--Outbound channel -->

    <citrus:channel-endpoint id="simulatorFileOutboundEndpoint" channel="fileOutboundChannel"/>

    <file:outbound-channel-adapter id="fileOutboundAdapter"
            channel="fileOutboundChannel"
            directory="file:${citrus.simulator.file.output.directory}"
            delete-source-files="true"/>

    <si:channel id="fileOutboundChannel"/>

    <!-- Starter channel -->
    <citrus:channel-endpoint id="simulatorFileStarterOutboundEndpoint"
            channel="fileStarterOutboundChannel"/>

    <file:outbound-channel-adapter id="fileStarterOutboundChannelAdapter"
            channel="fileStarterOutboundChannel"
            directory="file:${citrus.simulator.file.input.directory}"
            delete-source-files="true"/>

    <si:channel id="fileStarterOutboundChannel"/>

</beans>
